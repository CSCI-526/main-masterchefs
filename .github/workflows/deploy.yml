name: Build and Deploy WebGL to GitHub Pages

on:
  push:
    branches:
      - main   # Only run when main is updated

jobs:
  build:
    name: Build WebGL
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout your Unity project
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true  # Support for large files (like textures and models)

      # Step 2: Cache Unity dependencies for faster builds
      - name: Cache Unity packages
        uses: actions/cache@v3
        with:
          path: |
            ~/.cache/unity3d
            ~/.local/share/unity3d
          key: ${{ runner.os }}-unity-${{ hashFiles('**/Packages/manifest.json') }}
          restore-keys: |
            ${{ runner.os }}-unity-

      # Step 3: Build WebGL using GameCI
      - name: Build WebGL Player
        uses: game-ci/unity-builder@v4
        with:
          unityVersion: 2022.3.30f1   # Change this to match your Unity version
          targetPlatform: WebGL
          projectPath: Order-Up       # Folder where your Unity project lives
          buildName: WebGL
          buildsPath: build           # Output path (build/WebGL)

      # Step 4: Deploy to gh-pages branch
      - name: Deploy WebGL to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: build/WebGL
          publish_branch: gh-pages
          force_orphan: true  # Keeps gh-pages clean (optional but recommended)
